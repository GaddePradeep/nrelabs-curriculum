# regression test

This folder contains a docker-compose.yml file that launches vQFX with various Junos versions, each 
connected to two alpine based containers. Shell script check.sh waits for all PFEs to be up and reports
the total time it took to instantiate all vQFX's.

The script check_clients.sh runs a ping test between the alpine containers, followed by a MTU discvory
test between them. This is done for all running vQFXs. The ping result and max MTU are reported at the end:

```
$ make regress
docker-compose -f regression/docker-compose.yml up -d
Creating network "regression_mgmt" with the default driver
Creating regression_vqfx1_1    ... done
Creating regression_alpine3a_1 ... done
Creating regression_alpine2b_1 ... done
Creating regression_alpine4b_1 ... done
Creating regression_alpine1a_1 ... done
Creating regression_vqfx2_1    ... done
Creating regression_vqfx3_1    ... done
Creating regression_alpine1b_1 ... done
Creating regression_alpine3b_1 ... done
Creating regression_vqfx4_1    ... done
Creating regression_alpine4a_1 ... done
Creating regression_alpine2a_1 ... done
regression/add_links.sh
vqfx1 c88eac0b7cb2732a23276433003ed6abd81b3cad221edfe23abc2af0782c4e73
alpine1a 29a5d5ecaa4d0be78f1d5381d7b0f91ac73dcb9c42cc294672e6637287692f50
vqfx1 has pid 28345
alpine1a has pid 28615
vqfx1 has 1 eth interfaces
alpine1a has 1 eth interfaces
vqfx1:eth1 === alpine1a:eth1
vqfx1 c88eac0b7cb2732a23276433003ed6abd81b3cad221edfe23abc2af0782c4e73
alpine1b b26e79d12d4bc799d40bcb5dea24e9fbb1b77ed226c5849da9db030f3a9ffde1
vqfx1 has pid 28345
alpine1b has pid 29192
vqfx1 has 2 eth interfaces
alpine1b has 1 eth interfaces
vqfx1:eth2 === alpine1b:eth1
vqfx2 e9bb28394874248f45e1479d46653806bab440c4b14c07debc00a06cc44883f2
alpine2a f0899ebfaf43f3f25b27d115c0fb5e66a393a8e96e17c919ed9ecebfc80cb41c
vqfx2 has pid 28863
alpine2a has pid 29291
vqfx2 has 1 eth interfaces
alpine2a has 1 eth interfaces
vqfx2:eth1 === alpine2a:eth1
vqfx2 e9bb28394874248f45e1479d46653806bab440c4b14c07debc00a06cc44883f2
alpine2b a4d16ec28396bc8ebe1cf0389be752ab6a04c1c22c248dfb307b9d9cf5c94924
vqfx2 has pid 28863
alpine2b has pid 28886
vqfx2 has 2 eth interfaces
alpine2b has 1 eth interfaces
vqfx2:eth2 === alpine2b:eth1
vqfx3 ac8a9bf6fd89e5e03a9bb954e07cf287d98035a07e9c02bc6d7ad6202748f83c
alpine3a 8f9545fd2ee570879c30359be804e802a6095bab9315c6581593a9c5192e8ab9
vqfx3 has pid 29035
alpine3a has pid 28268
vqfx3 has 1 eth interfaces
alpine3a has 1 eth interfaces
vqfx3:eth1 === alpine3a:eth1
vqfx3 ac8a9bf6fd89e5e03a9bb954e07cf287d98035a07e9c02bc6d7ad6202748f83c
alpine3b 8dbab74b8771ff7a422521c53ba113e39cc44ba0ae24c35a9444b58ec244a198
vqfx3 has pid 29035
alpine3b has pid 28715
vqfx3 has 2 eth interfaces
alpine3b has 1 eth interfaces
vqfx3:eth2 === alpine3b:eth1
vqfx4 56e38b342b7fb77e0af5a47da1e08835b433678cf7d98ee2b4ab8c858b3b1d57
alpine4a f29d2fe2e8efa7e0913acda4aa4ee31e892a114eac5776d773394e31ba53611c
vqfx4 has pid 29469
alpine4a has pid 29424
vqfx4 has 1 eth interfaces
alpine4a has 1 eth interfaces
vqfx4:eth1 === alpine4a:eth1
vqfx4 56e38b342b7fb77e0af5a47da1e08835b433678cf7d98ee2b4ab8c858b3b1d57
alpine4b 2bc3ffa03cc743e8e6c7925cd6ad90d546b7692193f2b44578f6c601017978f8
vqfx4 has pid 29469
alpine4b has pid 28503
vqfx4 has 2 eth interfaces
alpine4b has 1 eth interfaces
vqfx4:eth2 === alpine4b:eth1
regression/check.sh
wait for fpc0 up in 4 instances (0 seconds)...
 ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (17 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (36 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (55 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (73 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (92 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (111 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (130 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (149 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (167 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (186 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (198 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root ...
vqfx2 (192.168.112.7) 18.1R1.9 root ...
vqfx1 (192.168.112.3) 17.3R3 root ...
wait for fpc0 up in 4 instances (210 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root ...
vqfx3 (192.168.112.9) 18.1R3 root fpc0 up
vqfx2 (192.168.112.7) 18.1R1.9 root fpc0 up
vqfx1 (192.168.112.3) 17.3R3 root fpc0 up
wait for fpc0 up in 4 instances (223 seconds)...
vqfx4 (192.168.112.13) 18.4R1.8 root fpc0 up
vqfx3 (192.168.112.9) 18.1R3 root fpc0 up
vqfx2 (192.168.112.7) 18.1R1.9 root fpc0 up
vqfx1 (192.168.112.3) 17.3R3 root fpc0 up
4 instances up in 225 seconds
SUCCESS
regression/check_clients.sh

regression_vqfx4_1 check connectivity between alpine4a and alpine4b:
PING 192.168.99.2 (192.168.99.2): 56 data bytes

--- 192.168.99.2 ping statistics ---
3 packets transmitted, 0 packets received, 100% packet loss

regression_vqfx3_1 check connectivity between alpine3a and alpine3b:
PING 192.168.99.2 (192.168.99.2): 56 data bytes
64 bytes from 192.168.99.2: seq=0 ttl=64 time=302.557 ms
64 bytes from 192.168.99.2: seq=1 ttl=64 time=100.490 ms
64 bytes from 192.168.99.2: seq=2 ttl=64 time=100.372 ms

--- 192.168.99.2 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 100.372/167.806/302.557 ms

regression_vqfx2_1 check connectivity between alpine2a and alpine2b:
PING 192.168.99.2 (192.168.99.2): 56 data bytes
64 bytes from 192.168.99.2: seq=0 ttl=64 time=300.964 ms
64 bytes from 192.168.99.2: seq=1 ttl=64 time=100.860 ms
64 bytes from 192.168.99.2: seq=2 ttl=64 time=100.813 ms

--- 192.168.99.2 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 100.813/167.545/300.964 ms

regression_vqfx1_1 check connectivity between alpine1a and alpine1b:
PING 192.168.99.2 (192.168.99.2): 56 data bytes
64 bytes from 192.168.99.2: seq=0 ttl=64 time=301.901 ms
64 bytes from 192.168.99.2: seq=1 ttl=64 time=100.754 ms
64 bytes from 192.168.99.2: seq=2 ttl=64 time=100.618 ms

--- 192.168.99.2 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 100.618/167.757/301.901 ms

regression_vqfx4_1 max MTU 1500
regression_vqfx3_1 max MTU 1500
regression_vqfx2_1 max MTU 1500
regression_vqfx1_1 max MTU 1500
```
